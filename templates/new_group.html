<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Authorization">
    <meta name="author" content="Kalymova Zhansaya, Boyarkin Dmitriy IT2-2312">
    <meta name="keywords" content="Weblog, blog, IITU, IT, Authorization">
    <title>New Group</title>
    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <link href="/static/bootstrap-icons.min.css" rel="stylesheet">
    <link href="/static/css.css" rel="stylesheet">
    <script src="/static/socket.io.min.js"></script>
    <script src="/static/bootstrap.bundle.min.js"></script>
    <style>
        section.auth-block {
            position: relative;
            background-color: #fff;
            border-left: 5px solid #c62828;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .image-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        figure img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid #c62828;
        }

        .image-wrapper img {
            object-fit: cover;
            transition: opacity 0.3s ease;
        }

        .overlay {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .overlay i {
            color: white;
            font-size: 2rem;
        }

        .image-wrapper:hover .overlay {
            opacity: 1;
        }

        form label {
            text-align: left;
            font-size: 0.9rem;
            color: #555;
        }

    </style>
</head>
<body>
<!-- Detect if PrivacyBadger/NoScript or AdBlocker disabled JavaScript -->
<noscript>
    <style type="text/css">
        #container {
            display: none;
        }
    </style>
        <div class="noscriptmsg">
        <header class="d-flex justify-content-between align-items-center px-3 py-2 border-bottom border-danger bg-light"
                style="position: sticky; min-height: 90px;">
            <div class="flex-grow-1 text-center">
                <img class="flex-grow-1 text-center" src="/static/logo.png" style="width: 150px" alt="LOGO">
            </div>
        </header>

        <main>
            <article>
                <figure style="place-items: center;">
                    <img src="/static/No_JavaScript.jpg" alt="X" class="text-danger m-3" style="width: 150px; height: 150px; font-size: 6rem; text-align: center; border: 0; border-radius: 0">
                    <figcaption class="text-secondary">JavaScript is disabled!</figcaption>
                    <figcaption style="font-size: 1rem; text-align: center;" class="text-secondary">And with almost the entire functionality of the website.<br>
                    Please enable at least JavaScript in your AdBlocker or privacy extensions before accessing this page.<br>
                    If you have any concern regarding the safety of your privacy, then you can check our GitHub page, where you will be able to see what methods and functions are used here.<br>
                        <a href="https://github.com/lshinigami/Kalymova_Boyarkin" target="_blank">https://github.com/lshinigami/Kalymova_Boyarkin</a></figcaption>
                </figure>
            </article>
        </main>
    </div>
</noscript>
<div id="container">
    <!-- Sidebar toggle menu -->
    <button class="menu-toggle" onclick="toggleMenu()"><i class="bi bi-list"></i></button>

    <!-- Sidebar -->
    <aside id="sidebar">
        <div class="text-center mb-4">
            <a href="/u/{{ login }}"><img src="/uploads/u/{{ login.lower() }}/ava.jpg" alt="User Avatar"
                                          onerror="this.src='/static/placeholder_ava.jpg';"></a>
            <a href="/u/{{ login }}"><p class="fw-bold mt-2">u/{{ login }}</p></a>
        </div>
        <nav>
            <ul>
                <li><a href="/"
                       class="deactivated-nav-txt">Home</a>
                </li>
                <li><a href="/?filter=popular"
                       class="deactivated-nav-txt">Popular</a></li>
                <li><a href="/?filter=latest"
                       class="deactivated-nav-txt">Latest</a>
                </li>

                <li class="mt-3 text-uppercase text-white-50 small">Subscriptions â–¼</li>
                <!-- This is a list of groups that the user is currently subscribed to.
                It will change dynamically through the Backend -->
                {% for sub in subs %}
                    <a href="/g/{{ sub }}" class="d-flex align-items-center gap-2">
                        <li>
                            <section>
                                <img src="/uploads/g/{{ sub.lower() }}/ava.jpg" alt="Group Icon"
                                     onerror="this.src='/static/group_ava_placeholder.jpg';">
                                <span>{{ sub }}</span>
                            </section>
                        </li>
                    </a>
                {% endfor %}
                <a href="/g/" class="d-flex align-items-center gap-2">
                    <li>
                        <section>
                            <img src="/static/new_group_ava.jpg">
                            <span>Create new Group</span>
                        </section>
                    </li>
                </a>
            </ul>
        </nav>
    </aside>
    <header class="d-flex justify-content-between align-items-center px-3 py-2 border-bottom border-danger bg-light"
            style="position: sticky; min-height: 90px;">
        <div class="flex-grow-1 text-center">
            <a href="/?filter=popular"><img class="flex-grow-1 text-center" src="/static/logo.png" style="width: 150px"
                                            alt="LOGO"></a>
        </div>
    </header>
    <main>
        <section class="auth-block">
            <h2 class="mb-4">New Group</h2>
            <form method="POST" class="mt-4 mx-auto" style="max-width:400px;" id="authForm"
                  enctype="multipart/form-data" onkeydown="return event.key != 'Enter';">
                <figure>
                    <input type="file" id="AvatarfileInput" name="gava" style="display: none;"
                           onchange="changeImg(event)" accept="image/*">
                    <div class="image-wrapper" onclick="document.getElementById('AvatarfileInput').click();">
                        <img id="AvatarImage"
                             src='/static/group_ava_placeholder.jpg'
                             alt="Avatar">
                        <div class="overlay">
                            <i class="bi bi-plus-lg"></i>
                        </div>
                    </div>
                </figure>
                <div class="mb-3 text-start">
                    <label for="group_name" class="form-label">Group Name</label>
                    <input type="text" id="group_name" name="group_name" class="form-control" maxlength="20"
                           placeholder="Enter group name..." required>
                    <div id="groupnameHelpBlock" class="form-text">

                    </div>
                </div>
                <button type="button" class="btn btn-danger btn-lg text-white mb-3" value="Create" onclick="sendForm()">
                    Create
                </button>
            </form>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 IITU Life</p>
    </footer>
</div>
<script>
    const groupnameInput = document.getElementById('group_name');
    const groupnameHelpBlock = document.getElementById('groupnameHelpBlock');
    document.addEventListener('DOMContentLoaded', function () {
        {% if error=="already" %}
            groupnameInput.classList.add('is-invalid');
            groupnameHelpBlock.textContent = 'This group already exist';
            groupnameHelpBlock.classList.remove('text-success');
            groupnameHelpBlock.classList.add('text-danger');
        {% elif error=="name" %}
            groupnameInput.classList.add('is-invalid');
            groupnameHelpBlock.textContent = 'Invalid group';
            groupnameHelpBlock.classList.remove('text-success');
            groupnameHelpBlock.classList.add('text-danger');
        {% endif %}
        groupnameInput.addEventListener('input', function () {
            const groupname = groupnameInput.value;
            let isValid = true;
            let feedbackMessage = ''
            const check = /^[a-zA-Z0-9_-]+$/.test(groupname);
            if (!check) {
                isValid = false;
            }
            if (isValid) {
                groupnameInput.classList.remove('is-invalid');
                groupnameHelpBlock.textContent = '';
                groupnameHelpBlock.classList.remove('text-danger');
                groupnameHelpBlock.classList.add('text-success');
            } else {
                groupnameInput.classList.add('is-invalid');
                groupnameHelpBlock.innerHTML = feedbackMessage.trim();
                groupnameHelpBlock.classList.remove('text-success');
                groupnameHelpBlock.classList.add('text-danger');
            }
            if (groupname === '') {
                groupnameInput.classList.add('is-invalid');
                groupnameHelpBlock.textContent = '';
                groupnameHelpBlock.classList.remove('text-success', 'text-danger');
            }
        })
    })

    function changeImg() {
        const file = document.getElementById('AvatarfileInput').files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('AvatarImage').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    }

    function toggleMenu() {
        document.getElementById("sidebar").classList.toggle("active");
    }

    function sendForm() {
        let should_we = false;
        const groupname = document.getElementById("group_name");
        if (groupname.value) {
            if (/^[a-zA-Z0-9_-]+$/.test(groupname.value)) {
                should_we = true;
            } else {
                groupnameInput.classList.add('is-invalid');
                groupnameHelpBlock.textContent = 'Invalid group name';
                groupnameHelpBlock.classList.remove('text-success');
                groupnameHelpBlock.classList.add('text-danger');
            }
        }
        if (should_we) {
            document.getElementById("authForm").submit();
        }
    }
</script>
</body>
</html>